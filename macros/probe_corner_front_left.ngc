o<probe_corner_front_left> sub

( Configuration )
#<ProbeDiameter> =   2.00    ( Diameter of the probe tip )
#<ProbeRadius>   =  [#<ProbeDiameter> / 2]

#<FastFeed>      = 300.0     ( Speed for initial search )
#<SlowFeed>      =  50.0     ( Speed for precise measurement )
#<Z_ProbeRange>  = -10.0     ( Max distance to search for Z down )
#<XY_ProbeRange> =  20.0     ( Max distance to search for X/Y edge )
#<SafeZ>         =  10.0     ( Height to lift after probing )
#<SideClearance> =  15.0     ( Distance to move sideways to clear the corner )
#<DepthDetect>   =  -4.0     ( Depth to drop Z for side probing - must be less than material thickness )
#<Retract>       =   2.0     ( Distance to back off after touching )

( ------------------------------------- )
( PREPARATION )
( ------------------------------------- )

G91                 ( Relative Mode )
G40                 ( Cancel Cutter Comp )
G49                 ( Cancel Tool Offsets )

( 1. PROBE Z - TOP SURFACE )
(MSG, Probing Z Surface...)
M64 P05 M64 P04     ( Enable Probes )
F[#<FastFeed>]
G38.2 Z[#<Z_ProbeRange>]
G0 Z[#<Retract>]    ( Fast Retract )
F[#<SlowFeed>]
G38.2 Z[-2 * #<Retract>] ( Slow Probe )
G10 L20 P0 Z0       ( Set Z Work Zero )
M65 P05 M65 P04     ( Disable Probes )

G0 Z[#<SafeZ>]      ( Lift to Safe Z )

( 2. PROBE X - LEFT EDGE )
(MSG, Moving to X Start Position...)
G0 Z[#<SafeZ>]      ( Lift Z )
G0 X[#<SideClearance> * -1] ( Move Left of the block )
G0 Z[#<DepthDetect>] ( Drop to Probe Depth - RELATIVE to Z0 which is now top of stock )

(MSG, Probing X Edge...)
M64 P05 M64 P04
F[#<FastFeed>]
G38.2 X[#<XY_ProbeRange>]   ( Probe Right towards edge )
G0 X[#<Retract> * -1]       ( Retract Left )
F[#<SlowFeed>]
G38.2 X[2 * #<Retract>]     ( Slow Probe Right )
M65 P05 M65 P04

( Set X Zero. The probe is touching the LEFT face. X=0 coincides with this face. )
( The probe center is at X = -Radius. So we set the current coordinate to -Radius )
G10 L20 P0 X[0 - #<ProbeRadius>] 

G0 Z[#<SafeZ>] ( Lift Z back to SafeZ )
G0 X[#<SideClearance> * -1] ( Move away from edge to be safe )

( 3. PROBE Y - FRONT EDGE )
(MSG, Moving to Y Start Position...)
( We are currently to the left of the block. We need to move to the front. )
( Move X back to X0-ish? No, better to move to a known safe spot )
G0 X[#<ProbeRadius> + 5] ( Move X slightly onto the block? No, risky if Y is not aligned )
( Strategy: Go back to Start X/Y? We don't know Start Y relative to edge yet. )
( Safe strategy: Move X positive to be "in front" of the block face, then move Y negative. )
( But if we are at X-Clearance, we are to the left. )
( Let's go to X = ProbeRadius + 5 (inside the block X-wise), then Y = -Clearance )
G0 X[#<SideClearance>] ( Move Right, past the edge, so we are "in front" of the face we want to probe )
G0 Y[#<SideClearance> * -1] ( Move Front of the block )
G0 Z[#<DepthDetect>] ( Drop to Probe Depth )

(MSG, Probing Y Edge...)
M64 P05 M64 P04
F[#<FastFeed>]
G38.2 Y[#<XY_ProbeRange>]   ( Probe Back towards edge )
G0 Y[#<Retract> * -1]       ( Retract Front )
F[#<SlowFeed>]
G38.2 Y[2 * #<Retract>]     ( Slow Probe Back )
M65 P05 M65 P04

( Set Y Zero. Probe is touching FRONT face. Y=0 is this face. )
( Probe center is at Y = -Radius. )
G10 L20 P0 Y[0 - #<ProbeRadius>]

G0 Z[#<SafeZ>] ( Lift Z )

( 4. FINISH )
G90                 ( Absolute Mode )
G0 X0 Y0            ( Move to the new Corner Zero )
(MSG, Corner Found! X0 Y0 Z0 Set.)

o<probe_corner_front_left> endsub
M2
